# StandX Perps Market Maker

![License](https://img.shields.io/badge/license-MIT-green)
![Python](https://img.shields.io/badge/python-3.11-blue)
![Status](https://img.shields.io/badge/status-alpha-orange)

ç®€è¿°ï¼šåŸºäº StandX Perps (BSC) çš„åŒå‘é™ä»·åšå¸‚è„šæœ¬ï¼Œä»¥ target_bpsï¼ˆé»˜è®¤ 7.5ï¼‰ä¸ºä¸­å¿ƒæŒ‚å•ï¼Œç»´æŒä»·æ ¼åç¦»èŒƒå›´ [min_bps, max_bps]ï¼Œè¶…å‡ºæ—¶è‡ªåŠ¨é‡æŒ‚ï¼›0.5 ç§’ç›‘æ§é—´éš”ï¼ŒæŒç»­è¿è¡Œè‡³æ”¶åˆ°åœæ­¢ä¿¡å·ã€‚

## åŠŸèƒ½æ¦‚è§ˆ
- **ä¸‰å±‚æ¶æ„**ï¼š
  - [standx_auth.py](standx_auth.py)ï¼šé’±åŒ…è®¤è¯ä¸ HTTP å·¥å…·ï¼ˆ`make_api_call`ã€`_body_signature_headers`ï¼‰
  - [standx_api.py](standx_api.py)ï¼šAPI æ–¹æ³•åº“ï¼ˆ9 ä¸ªå‡½æ•°ï¼‰
  - [market_maker.py](market_maker.py)ï¼šåšå¸‚ç­–ç•¥ä¸»ç¨‹åº
- åšå¸‚ç­–ç•¥ï¼š0.5 ç§’è½®è¯¢ç›‘æ§ï¼Œä¸‰æ­¥æµç¨‹ï¼ˆæ£€æŸ¥æŒä»“ â†’ æ£€æŸ¥ä»·æ ¼åç¦» â†’ é‡æŒ‚è®¢å•ï¼‰
- ä»·æ ¼æºï¼šä¼˜å…ˆä½¿ç”¨ mark_priceï¼Œä¿è¯å¥–åŠ±èµ„æ ¼åˆ¤å®šä¸€è‡´
- å®¹é”™ï¼šTimeout/ConnectionError/ProxyError è‡ªåŠ¨é‡è¯• 3 æ¬¡ï¼›è®¢å•åˆ·æ–°å¤±è´¥æ—¶ä½¿ç”¨ä¸Šæ¬¡ç¼“å­˜ç»§ç»­è¿è¡Œ
- ä¼˜é›…å…³é—­ï¼šæ”¯æŒ SIGTERM/SIGINT ä¿¡å·å¤„ç†ï¼Œåœæ­¢æ—¶è‡ªåŠ¨å–æ¶ˆæ‰€æœ‰è®¢å•

## ç¯å¢ƒè¦æ±‚
- Python 3.11+
- pip / venv
- Git

## å®‰è£…ä¸è¿è¡Œ
```bash
# å…‹éš†ä»£ç 
git clone https://github.com/ethan0xbuilds/standx-perps-market-maker.git && cd standx-perps-market-maker

# åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
python3.11 -m venv .venv
source .venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å…¥ç§é’¥å’Œå‚æ•°

# è¿è¡Œï¼ˆ0.5 ç§’ç›‘æ§é—´éš”ï¼Œæ— é™è¿è¡Œç›´è‡³æ”¶åˆ°åœæ­¢ä¿¡å·ï¼‰
python market_maker.py
```

## ç¯å¢ƒå˜é‡ (.env)
```
WALLET_PRIVATE_KEY=0x...

# Market maker configuration
MARKET_MAKER_SYMBOL=BTC-USD          # äº¤æ˜“å¯¹
MARKET_MAKER_QTY=0.005               # å•ç¬”è®¢å•æ•°é‡
MARKET_MAKER_TARGET_BPS=7.5          # ç›®æ ‡æŒ‚å•åç¦» (basis points)
MARKET_MAKER_MIN_BPS=7.0             # æœ€å°å…è®¸åç¦»ï¼Œä½äºæ­¤å€¼é‡æŒ‚
MARKET_MAKER_MAX_BPS=10              # æœ€å¤§å…è®¸åç¦»ï¼Œè¶…è¿‡æ­¤å€¼é‡æŒ‚

# Balance-based degradation (risk control)
MARKET_MAKER_BALANCE_THRESHOLD_1=100  # é™çº§é˜ˆå€¼1ï¼ˆå•ä½ï¼šUSDTï¼‰
MARKET_MAKER_BALANCE_THRESHOLD_2=50   # é™çº§é˜ˆå€¼2ï¼ˆå•ä½ï¼šUSDTï¼‰
```

**å‚æ•°è¯´æ˜**ï¼š
- åˆå§‹ä¸‹å•æ—¶ä»¥ `target_bps` ä¸ºåŸºå‡†è®¡ç®—ä»·æ ¼
- ç›‘æ§ä¸­å¦‚æœå®é™…åç¦»è¶…å‡º [min_bps, max_bps] èŒƒå›´ï¼Œåˆ™å–æ¶ˆæ‰€æœ‰è®¢å•å¹¶é‡æ–°æŒ‚å•
- ç¤ºä¾‹ï¼šå¸‚ä»· 100ï¼Œåˆ™ä»¥ 7.5 bps æŒ‚å• â†’ ä¹° 99.925ï¼Œå– 100.075

## ä½™é¢è‡ªåŠ¨é™çº§ç­–ç•¥
ç­–ç•¥å†…ç½®**ä¸‰å±‚é£é™©æ§åˆ¶æœºåˆ¶**ï¼Œæ ¹æ®å®æ—¶ä½™é¢è‡ªåŠ¨åˆ‡æ¢è¿è¡Œæ¨¡å¼ã€‚æ¯ 10 æ¬¡è¿­ä»£ï¼ˆçº¦ 5 ç§’ï¼‰æ£€æŸ¥ä¸€æ¬¡ä½™é¢ï¼Œè‹¥ä½™é¢è·¨è¶Šé˜ˆå€¼åˆ™è‡ªåŠ¨è°ƒæ•´æŒ‚å•å‚æ•°ã€‚

### è¿è¡Œæ¨¡å¼å¯¹ç…§è¡¨

| ä½™é¢èŒƒå›´ | æ¨¡å¼ | target_bps | min_bps | max_bps | è¯´æ˜ |
|--------|------|-----------|---------|---------|------|
| â‰¥ 100 USDT | **normal** | 7.5 | 7.0 | 10 | æ­£å¸¸åšå¸‚ï¼Œç†æƒ³åˆ©æ¶¦ç©ºé—´ |
| 50-100 USDT | **degraded_1** | 25 | 20 | 29.5 | æ‰‹ç»­è´¹å®¹å¿æ¨¡å¼ï¼Œæ‰©å¤§ä»·å·® |
| < 50 USDT | **degraded_2** | 80 | 70 | 95 | æ­¢æŸä¿æŠ¤æ¨¡å¼ï¼Œæç«¯ä»·å·®å¿«é€Ÿè·åˆ© |

### å·¥ä½œåŸç†
1. **åˆå§‹åŒ–**ï¼šå¯åŠ¨æ—¶è°ƒç”¨ `check_and_update_mode()` ç¡®å®šåˆå§‹æ¨¡å¼
2. **å®šæœŸæ£€æŸ¥**ï¼šç›‘æ§å¾ªç¯ä¸­æ¯ 10 æ¬¡è¿­ä»£æ£€æŸ¥ä¸€æ¬¡ä½™é¢
3. **è‡ªåŠ¨åˆ‡æ¢**ï¼šä½™é¢å˜åŒ–è§¦å‘æ¨¡å¼è½¬æ¢æ—¶ï¼š
   - å–æ¶ˆå½“å‰è®¢å•
   - æ›´æ–°æŒ‚å•å‚æ•°
   - é‡æ–°ä¸‹åŒå‘å•
4. **æ•…éšœå®¹é”™**ï¼šä½™é¢æŸ¥è¯¢å¤±è´¥æ—¶ä¿æŒå½“å‰æ¨¡å¼ï¼Œç»§ç»­è¿è¡Œ

### æ¨¡å¼åˆ‡æ¢ç¤ºä¾‹
```
åˆå§‹çŠ¶æ€ï¼šä½™é¢ 120 USDT â†’ normal æ¨¡å¼ï¼ˆ7.5 bpsï¼‰
          æŒ‚å•ï¼šä¹° 99.925 @ 0.005ï¼Œå– 100.075 @ 0.005

å¸‚åœºä¸‹è·Œï¼Œä½™é¢æ‰£è´¹åå˜ä¸º 85 USDT
â†“ è§¦å‘é™çº§
é™çº§åï¼šdegraded_1 æ¨¡å¼ï¼ˆ25 bpsï¼‰
        é‡æ–°æŒ‚å•ï¼šä¹° 99.75 @ 0.005ï¼Œå– 100.25 @ 0.005
        ï¼ˆä»·å·®æ‰©å¤§è‡³ 0.5ï¼ŒæŠµæ¶ˆæ‰‹ç»­è´¹å‹åŠ›ï¼‰

ç»§ç»­äºæŸï¼Œä½™é¢é™è‡³ 40 USDT
â†“ å†æ¬¡é™çº§
æç«¯æ¨¡å¼ï¼šdegraded_2 æ¨¡å¼ï¼ˆ80 bpsï¼‰
         é‡æ–°æŒ‚å•ï¼šä¹° 99.2 @ 0.005ï¼Œå– 100.8 @ 0.005
         ï¼ˆæç«¯ä»·å·®å¿«é€Ÿè·åˆ©ï¼Œè§¦å‘æ­¢æŸä¿æŠ¤ï¼‰
```

### å¦‚ä½•è®¾ç½®é˜ˆå€¼
- `BALANCE_THRESHOLD_1`ï¼šè®¾ç½®ä¸ºä½ èƒ½æ¥å—çš„"å¼€å§‹è°¨æ…åšå¸‚"çš„ä½™é¢é—¨æ§›
- `BALANCE_THRESHOLD_2`ï¼šè®¾ç½®ä¸ºä½ çš„"æ­¢æŸçº¢çº¿"ï¼Œä½äºæ­¤å€¼åˆ™é‡‡ç”¨æç«¯ä»·å·®æ¨¡å¼

### æ‰“å°æ—¥å¿—ç¤ºä¾‹
```
ğŸ”„ ä½™é¢: 85.32 USDT
   æ¨¡å¼åˆ‡æ¢: æ­£å¸¸æ¨¡å¼ â†’ é™çº§æ¨¡å¼1-æ‰‹ç»­è´¹å®¹å¿
   æ–°æŒ‚å•ç­–ç•¥: target=25 bps, èŒƒå›´=[20, 29.5]
```

## è¿è¡Œæ¨¡å¼
é»˜è®¤æ— é™è¿è¡Œã€‚ç­–ç•¥ä¼šå¾ªç¯æ‰§è¡Œä»¥ä¸‹ä¸‰æ­¥ï¼š
1. **æ£€æŸ¥æŒä»“**ï¼šè‹¥å­˜åœ¨æŒä»“åˆ™ç«‹å³å¸‚ä»·å¹³ä»“
2. **æ£€æŸ¥ä»·æ ¼åç¦»**ï¼šä¹°å–å•åç¦»æ˜¯å¦åœ¨ [min_bps, max_bps] èŒƒå›´å†…
3. **é‡æŒ‚è®¢å•**ï¼šè‹¥è¶…å‡ºèŒƒå›´åˆ™å–æ¶ˆæ‰€æœ‰è®¢å•ï¼Œç­‰å¾… 1 ç§’ï¼Œé‡æ–°ä¸‹åŒå‘å•

æ¯æ¬¡æ£€æŸ¥é—´éš”ä¸º **0.5 ç§’**ï¼Œå¯é€šè¿‡ä¿®æ”¹ [market_maker.py](market_maker.py#L403) çš„ `market_maker.run(check_interval=0.5)` è°ƒæ•´ã€‚

### ä¼˜é›…å…³é—­
ç¨‹åºæ”¯æŒ SIGTERM/SIGINT ä¿¡å·ï¼Œæ”¶åˆ°åœæ­¢ä¿¡å·æ—¶ä¼šï¼š
1. æ ‡è®° `_shutdown_requested` ä¸º True
2. ç­‰å¾…å½“å‰è¿­ä»£å®Œæˆ
3. æ¸…ç†æ‰€æœ‰è®¢å•
4. ä¼˜é›…é€€å‡º

### Ubuntu ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼ˆæ¨èï¼‰
```bash
# 1. å¯åŠ¨ï¼ˆåå°è¿è¡Œ + æ—¥å¿—è¾“å‡ºï¼‰
chmod +x run.sh stop.sh
./run.sh

# 2. ç›‘æ§æ—¥å¿—
tail -f logs/market_maker.log

# 3. åœæ­¢
./stop.sh
```

**å¯åŠ¨è„šæœ¬ç‰¹æ€§**ï¼š
- è‡ªåŠ¨æ£€æµ‹è™šæ‹Ÿç¯å¢ƒå’Œé…ç½®æ–‡ä»¶
- é˜²æ­¢é‡å¤å¯åŠ¨
- æ—¥å¿—å®æ—¶å†™å…¥ `logs/market_maker.log`
- PID ç®¡ç†ï¼Œæ–¹ä¾¿åœæ­¢

### æ‰‹åŠ¨åå°è¿è¡Œ
```bash
nohup python -u market_maker.py >> run.log 2>&1 &
# è§‚å¯Ÿæ—¥å¿—
tail -f run.log
```

## å·²çŸ¥è¡Œä¸ºä¸ç­–ç•¥è¦ç‚¹
- ç›‘æ§é—´éš” 0.5 ç§’ï¼ˆå¯è°ƒæ•´ï¼‰ï¼›ä»·æ ¼åç¦»è¶…å‡º [min_bps, max_bps] æ—¶é‡æŒ‚
- æ£€æµ‹åˆ°æŒä»“æ—¶ç«‹å³å¸‚ä»·å¹³ä»“ï¼Œä¿è¯ä¸è¿åæ æ†é™åˆ¶
- ä»·æ ¼ä¼˜å…ˆå– mark_priceï¼›æ¥å£å¤±è´¥ä¼šåœ¨ä¸‹æ¬¡è¿­ä»£é‡è¯•
- è®¢å•çŠ¶æ€æŸ¥è¯¢å¤±è´¥æ—¶ä½¿ç”¨ä¸Šæ¬¡ç¼“å­˜çŠ¶æ€ï¼Œä¸ä¸­æ–­ç­–ç•¥
- æ—¶é—´åŒæ­¥å¾ˆé‡è¦ï¼šè¯·åœ¨æœåŠ¡å™¨å¯ç”¨ `timedatectl set-ntp true`ï¼Œå¦åˆ™å¯èƒ½è§¦å‘ç­¾åè¿‡æœŸï¼ˆ403 é”™è¯¯ï¼‰
- `.env` ä¸ç§é’¥ä¸¥ç¦å…¥åº“ï¼Œå·²åœ¨ [.gitignore](.gitignore) ä¸­å¿½ç•¥

## ç›¸å…³æ–‡ä»¶
- åšå¸‚ä¸»ç¨‹åºï¼š[market_maker.py](market_maker.py)ï¼ˆ430 è¡Œï¼‰
  - åŒå‘é™ä»·å•ç®¡ç†ã€ä»·æ ¼ç›‘æ§ã€è®¢å•è°ƒæ•´
- è®¤è¯ä¸ HTTP å·¥å…·ï¼š[standx_auth.py](standx_auth.py)ï¼ˆ308 è¡Œï¼‰
  - EIP-191 + Ed25519 é’±åŒ…è®¤è¯
  - `make_api_call()`ï¼šé€šç”¨ HTTP è¯·æ±‚å·¥å…·ï¼ˆæ”¯æŒé‡è¯•ï¼‰
  - `_body_signature_headers()`ï¼šEd25519 ç­¾åç”Ÿæˆï¼ˆç”¨äºæœ‰åº APIï¼‰
- API æ–¹æ³•åº“ï¼š[standx_api.py](standx_api.py)ï¼ˆ190 è¡Œï¼‰
  - 9 ä¸ªå‡½æ•°ï¼šquery_balanceã€query_symbol_priceã€query_positions
  - è®¢å•å‡½æ•°ï¼šnew_limit_orderã€new_market_orderã€cancel_order
  - æŸ¥è¯¢å‡½æ•°ï¼šquery_orderã€query_open_ordersã€query_orders
- ä¾èµ–åˆ—è¡¨ï¼š[requirements.txt](requirements.txt)

## éƒ¨ç½²å»ºè®®
- ä»£ç ä»“åº“ä½¿ç”¨ç§æœ‰ä»“åº“ï¼Œé¿å…æ³„éœ²ç­–ç•¥ä¸ç§é’¥ã€‚éƒ¨ç½²æ—¶æ‰‹å·¥åŒæ­¥ `.env`ã€‚
- å‡ºé”™æ—¶å…ˆçœ‹æ—¥å¿—ä¸­çš„ç½‘ç»œé”™è¯¯ä¸æ—¶é—´åŒæ­¥ï¼›å¿…è¦æ—¶é‡å¯è„šæœ¬æˆ–é‡æ–°è·å–æ—¶é—´ã€‚

## License
MIT License
